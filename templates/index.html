<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>
    <style>
        .organizer-calendar .fc-toolbar {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .calendar-container {
            margin-right: 20px;
            width: calc(100%); /* Adjust width as needed */
        }
        .calendar-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            word-break: break-all;
        }
        .fc-event-cancelled {
            color: gray !important;
            text-decoration: line-through;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/get_events')
                .then(response => response.json())
                .then(data => {
                    const organizers = {};

                    // Group events by organizer
                    data.forEach(event => {
                        const organizer = event.organizer || "Unknown Organizer";
                        if (!organizers[organizer]) {
                            organizers[organizer] = [];
                        }
                        organizers[organizer].push(event);
                    });

                    // Create calendars for each organizer
                    const calendarWrapper = document.getElementById('calendar-wrapper');
                    for (const [organizer, events] of Object.entries(organizers)) {
                        const calendarContainer = document.createElement('div');
                        calendarContainer.classList.add('calendar-container');
                        
                        const organizerTitle = document.createElement('div');
                        organizerTitle.classList.add('calendar-title');
                        organizerTitle.textContent = organizer;
                        calendarContainer.appendChild(organizerTitle);
                        
                        const calendarEl = document.createElement('div');
                        calendarEl.classList.add('organizer-calendar');
                        calendarContainer.appendChild(calendarEl);
                        
                        calendarWrapper.appendChild(calendarContainer);

                        const calendar = new FullCalendar.Calendar(calendarEl, {
                            initialView: 'timeGridWeek',
                            headerToolbar: {
                                left: 'prev,next today',
                                center: 'title',
                                right: 'timeGridWeek,timeGridDay'
                            },
                            navLinks: true,
                            editable: true,
                            selectable: true,
                            nowIndicator: true,
                            weekNumbers: true,
                            events: events.map(event => ({
                                ...event,
                                className: event.isCancelled ? 'fc-event-cancelled' : ''
                            })),
                            // 時間表示を24時間表記に変更
                            views: {
                                timeGrid: {
                                    slotLabelFormat: {
                                        hour: '2-digit',
                                        minute: '2-digit',
                                        hour12: false
                                    }
                                },
                                week: {
                                    columnHeaderFormat: {
                                        weekday: 'short',
                                        day: 'numeric',
                                        omitCommas: true
                                    }
                                },
                                day: {
                                    columnHeaderFormat: {
                                        weekday: 'short',
                                        day: 'numeric',
                                        omitCommas: true
                                    }
                                }
                            }

                        });

                        calendar.render();
                    }
                });
        });
    </script>
</head>
<body>
    <a href="/ones_calendar">個別のカレンダー表示へ</a>
    <a href="/logout">ログアウト</a>
    <div id='calendar-wrapper'></div>
</body>
</html>